from numpy import floor, ceil


def uniform_ci(x, confidence, slop=5):
    m, M = min(x), max(x)
    n = len(x)
    q = get_q(n, confidence)
    lower_ci = (int(floor((1 - q) * (M - m) + m)),
                m + slop)
    upper_ci = (M - slop,
                int(ceil(q * (M - m) + m)))
    return lower_ci, upper_ci


def get_q(n, confidence):
    d = {.95: 0, .9: 1, .85: 2, .8: 3}
    idx = min(n, 100) - 1       # only support up to size 100
    return pearson_quantiles[idx][d[confidence]]


# quantiles of a Pearson type VI distribution (expo divided by indep. gamma)
# generated using the PearsonDS R package
# columns are for 95% CI, 90%, 85%, 80%   [see dict d above]
pearson_quantiles = \
    ((1e100, 1e100, 1e100, 1e100),
     (20, 10, 6.66666666666667, 5),
     (4.47213595499958, 3.16227766016838, 2.58198889747161, 2.23606797749979),
     (2.71441761659491, 2.15443469003188, 1.88207205776206, 1.7099759466767),
     (2.11474252688113, 1.77827941003892, 1.6068568378893, 1.49534878122122),
     (1.82056420302608, 1.58489319246111, 1.46144255162193, 1.37972966146121),
     (1.64754897244207, 1.46779926762207, 1.37188631371628, 1.30766048601183),
     (1.53412740463439, 1.38949549437314, 1.31129754674717, 1.25849895064183),
     (1.45421543344895, 1.33352143216332, 1.26761856955841, 1.22284454499385),
     (1.39495079396242, 1.29154966501488, 1.23465442045882, 1.1958131745004),
     (1.34928284767356, 1.25892541179417, 1.20890138209116, 1.17461894308802),
     (1.31303243448788, 1.23284673944207, 1.18823077030121, 1.15755791177065),
     (1.28356884211252, 1.21152765862859, 1.17127550717851, 1.14352983608292),
     (1.25915510457657, 1.19377664171444, 1.1571178560763, 1.13179279115279),
     (1.23859896844555, 1.17876863479359, 1.14511900986193, 1.121828396254),
     (1.22105530006757, 1.16591440117983, 1.13482070087734, 1.1132635768448),
     (1.2059085510307, 1.15478198468946, 1.12588568227792, 1.10582301703024),
     (1.19269988180426, 1.14504756993828, 1.11806028250332, 1.09929912581038),
     (1.18108035034134, 1.13646366638572, 1.11115004407992, 1.09353242956046),
     (1.17077991372278, 1.12883789168469, 1.10500340924788, 1.08839840073039),
     (1.16158634964154, 1.12201845430196, 1.09950051482078, 1.08379838673437),
     (1.15333058538934, 1.11588399250775, 1.09454532299973, 1.07965322389736),
     (1.1458762736386, 1.11033631816764, 1.09005998472616, 1.07589865311313),
     (1.13911224808052, 1.10529514112602, 1.08598073028686, 1.07248197098697),
     (1.13294697233035, 1.10069417125221, 1.08225482543554, 1.06935954481312),
     (1.12730439408171, 1.09647819614319, 1.07883828417572, 1.06649494220837),
     (1.1221208065875, 1.09260086111738, 1.07569412756429, 1.06385750509774),
     (1.11734244323153, 1.08902296226373, 1.07279104232753, 1.06142124961051),
     (1.11292361303261, 1.0857111194022, 1.0701023361632, 1.0591640081942),
     (1.10882524037588, 1.08263673387405, 1.06760511591417, 1.05706675394235),
     (1.10501371035276, 1.07977516232771, 1.06527963506177, 1.05511306353623),
     (1.10145994764715, 1.07710505603677, 1.06310877120106, 1.05328868672729),
     (1.09813867568295, 1.07460782832132, 1.06107760426743, 1.05158119849598),
     (1.09502781619681, 1.07226722201032, 1.05917307356098, 1.04997971594093),
     (1.09210799914855, 1.07006895569317, 1.0573836969158, 1.04847466627019),
     (1.0893621600274, 1.06800043251458, 1.05569933926511, 1.04705759544891),
     (1.08677520690405, 1.06605049898479, 1.05411102075632, 1.04572100942864),
     (1.08433374353668, 1.06420924406472, 1.05261075675065, 1.04445824166542),
     (1.08202583782587, 1.06246783089404, 1.05119142369403, 1.04326334198532),
     (1.07984082718679, 1.06081835513945, 1.04984664610735, 1.04213098288986),
     (1.07776915415201, 1.05925372517729, 1.04857070091662, 1.04105638019003),
     (1.07580222686676, 1.05776756028318, 1.0473584360967, 1.04003522547643),
     (1.07393230018905, 1.05635410374919, 1.0462052011913, 1.03906362841616),
     (1.07215237393049, 1.05500814843655, 1.04510678773505, 1.03813806724797),
     (1.07045610542357, 1.05372497273607, 1.04405937796955, 1.03725534614825),
     (1.06883773411671, 1.05250028527773, 1.04305950053714, 1.03641255838068),
     (1.06729201631068, 1.05133017702624, 1.04210399206934, 1.0356070543343),
     (1.06581416848037, 1.05021107963667, 1.04118996377507, 1.03483641371008),
     (1.06439981789286, 1.04913972913631, 1.04031477228555, 1.034098421241),
     (1.06304495944939, 1.04811313415469, 1.03947599413644, 1.03339104543288),
     (1.06174591785498, 1.0471285480509, 1.03867140336861, 1.03271241989644),
     (1.06049931436413, 1.04618344439183, 1.03789895181192, 1.03206082690945),
     (1.05930203746972, 1.04527549532043, 1.03715675168428, 1.03143468290423),
     (1.05815121700027, 1.04440255242457, 1.03644306019509, 1.03083252562254),
     (1.05704420117208, 1.04356262977539, 1.03575626588862, 1.03025300271851),
     (1.05597853621039, 1.04275388885377, 1.03509487650236, 1.02969486162266),
     (1.05495194821025, 1.04197462512395, 1.03445750814772, 1.02915694050723),
     (1.05396232695515, 1.04122325604831, 1.03384287564814, 1.02863816021572),
     (1.05300771145129, 1.04049831036579, 1.03324978389263, 1.02813751703863),
     (1.05208627696893, 1.03979841848149, 1.03267712008251, 1.02765407623365),
     (1.05119632341098, 1.03912230383517, 1.03212384676538, 1.02718696620247),
     (1.05033626485263, 1.03846877513435, 1.03158899556476, 1.02673537324768),
     (1.0495046201171, 1.0378367193527, 1.03107166152555, 1.02629853684359),
     (1.04870000426947, 1.03722509540706, 1.03057099800607, 1.02587574536305),
     (1.04792112092607, 1.0366329284377, 1.03008621205578, 1.02546633220988),
     (1.04716675528959, 1.03605930462563, 1.02961656022592, 1.0250696723126),
     (1.04643576783136, 1.03550336648913, 1.0291613447662, 1.02468517894079),
     (1.04572708855154, 1.03496430860848, 1.028719910167, 1.02431230080986),
     (1.04503971175671, 1.03444137373424, 1.02829164001065, 1.02395051944427),
     (1.04437269130105, 1.0339338492394, 1.02787595410039, 1.0235993467727),
     (1.04372513624393, 1.03344106388056, 1.02747230583851, 1.02325832293166),
     (1.04309620688201, 1.03296238483709, 1.02708017982914, 1.02292701425673),
     (1.04248511111864, 1.03249721500099, 1.0266990896832, 1.02260501144315),
     (1.04189110113765, 1.03204499049279, 1.02632857600628, 1.02229192785911),
     (1.04131347035208, 1.03160517838208, 1.02596820455151, 1.02198739799736),
     (1.04075155060185, 1.03117727459306, 1.0256175645222, 1.02169107605197),
     (1.04020470957686, 1.03076080197786, 1.02527626701003, 1.02140263460857),
     (1.03967234844462, 1.0303553085423, 1.02494394355644, 1.02112176343781),
     (1.03915389966395, 1.02996036580999, 1.02462024482603, 1.02084816838248),
     (1.03864882496761, 1.02957556731251, 1.02430483938185, 1.02058157033003),
     (1.03815661349914, 1.02920052719443, 1.02399741255368, 1.02032170426294),
     (1.03767678009012, 1.02883487892305, 1.02369766539106, 1.02006831838009),
     (1.03720886366573, 1.0284782740939, 1.0234053136938, 1.01982117328306),
     (1.03675242576766, 1.02813038132378, 1.02312008711341, 1.01958004122179),
     (1.03630704918429, 1.02779088522383, 1.02284172831934, 1.01934470539468),
     (1.03587233667926, 1.02745948544618, 1.02256999222484, 1.0191149592985),
     (1.03544790981029, 1.0271358957979, 1.02230464526727, 1.01889060612412),
     (1.03503340783072, 1.02681984341689, 1.02204546473874, 1.01867145819424),
     (1.03462848666735, 1.02651106800466, 1.02179223816271, 1.0184573364399),
     (1.03423281796815, 1.02620932111153, 1.02154476271319, 1.01824806991245),
     (1.03384608821464, 1.02591436547001, 1.02130284467299, 1.01804349532851),
     (1.03346799789362, 1.02562597437275, 1.02106629892809, 1.01784345664503),
     (1.03309826072387, 1.02534393109153, 1.02083494849527, 1.01764780466245),
     (1.03273660293345, 1.02506802833418, 1.02060862408061, 1.01745639665358),
     (1.0323827625839, 1.0247980677366, 1.02038716366636, 1.01726909601643),
     (1.03203648893777, 1.02453385938722, 1.02017041212421, 1.01708577194907),
     (1.03169754186625, 1.02427522138159, 1.01995822085297, 1.01690629914511),
     (1.03136569129405, 1.02402197940476, 1.01975044743885, 1.01673055750802),
     (1.03104071667873, 1.02377396633959, 1.01954695533675, 1.01655843188322),
     (1.03072240652209, 1.02353102189903, 1.01934761357106, 1.01638981180644))
